--- live_engine.py
+++ live_engine.py
@@ -23,8 +24,8 @@ class ConnectionStatus:
 
 
 class LiveEngine:
-    KALSHI_WSS_DEMO = "wss://demo-api.kalshi.co/trade-api/v2/ws"
-    KALSHI_WSS_PROD = "wss://api.kalshi.com/trade-api/v2/ws"
+    KALSHI_WSS_DEMO = "wss://demo-api.kalshi.co/trade-api/ws/v2"
+    KALSHI_WSS_PROD = "wss://api.elections.kalshi.com/trade-api/ws/v2"
     POLY_WSS = "wss://ws-subscriptions-clob.polymarket.com/ws/market"
     
     POLY_API = "https://clob.polymarket.com"
@@ -59,8 +62,9 @@ class LiveEngine:
     def add_status_callback(self, callback: Callable):
         self._status_callbacks.append(callback)
         
+    def add_price_callback(self, callback: Callable):
         self._price_callbacks.append(callback)
-        
+
     def add_raw_callback(self, callback: Callable):
         self._raw_callbacks.append(callback)
         
@@ -140,15 +143,18 @@ class LiveEngine:
             
         while self._running:
             try:
+                logger.info(f"Connecting to Kalshi: {url}")
                 async with websockets.connect(url, **kwargs) as ws:
                     self.kalshi_status.connected = True
                     self.kalshi_status.last_heartbeat = time.time()
                     await self._notify_status(self.kalshi_status)
                     
                     await ws.send(json.dumps({
-                        "type": "subscribe",
-                        "channel": "markets",
-                        "markets": ["*"]
+                        "id": int(time.time()),
+                        "cmd": "subscribe",
+                        "params": {
+                            "channels": ["ticker", "trade"]
+                        }
                     }))
                     
                     async for message in ws:
@@ -156,19 +162,32 @@ class LiveEngine:
                             break
                             
                         try:
+                            # Handle bytes message
+                            if isinstance(message, bytes):
+                                message = message.decode('utf-8')
+                            
                             # Forward raw message
                             await self._notify_raw("kalshi", message)
                             
                             data = json.loads(message)
                             self.kalshi_status.messages_received += 1
                             
-                            if isinstance(data, list):
-                                for item in data:
+                            msg_type = data.get("type", "")
+                            
+                            # Skip subscription confirmations and heartbeats
+                            if msg_type in ["subscribed", "heartbeat"]:
+                                continue
+                            
+                            # Handle message in msg field for new format
+                            msg_data = data.get("msg", data)
+                            
+                            if isinstance(msg_data, list):
+                                for item in msg_data:
                                     await self._process_kalshi_message(item)
                                     await self._notify_price("kalshi", item)
                             else:
-                                await self._process_kalshi_message(data)
-                                await self._notify_price("kalshi", data)
+                                await self._process_kalshi_message(msg_data)
+                                await self._notify_price("kalshi", msg_data)
                             
                         except Exception as e:
                             # Catch all to prevent disconnect on bad message format
@@ -246,15 +277,14 @@ class LiveEngine:
                             logger.error(f"Failed to fetch Poly markets: {e}")
                             
                     if not token_ids:
-                        # Fallback static token for testing if fetch fails (e.g. some active token id)
-                        token_ids = ["59441160358925232801458852870404391219089069695648877112104523996766487955513"] # Trump 2024 token id approx
-                            
+                        token_ids = [""] 
+                    
                     sub_msg = {
                         "type": "market",
                         "operation": "subscribe",
-                        "assets_ids": token_ids[:100]  # Subscribe to up to 100 active tokens
+                        "assets_ids": token_ids[:50] if token_ids else [],
                     }
-                    logger.debug(f"Subscribing to Poly with {len(token_ids[:100])} tokens.")
+                    logger.info(f"Subscribing to Poly market data")
                     await ws.send(json.dumps(sub_msg))
                     
                     async for message in ws:
@@ -262,12 +292,21 @@ class LiveEngine:
                             break
                             
                         try:
+                            # Handle bytes message
+                            if isinstance(message, bytes):
+                                message = message.decode('utf-8')
+                            
                             # Forward raw message
                             await self._notify_raw("polymarket", message)
                             
                             data = json.loads(message)
                             self.poly_status.messages_received += 1
                             
+                            # Skip pings
+                            if data.get("type") == "ping":
+                                await ws.send(json.dumps({"type": "pong"}))
+                                continue
+                            
                             if isinstance(data, list):
                                 for item in data:
                                     await self._process_poly_message(item)
